%RUN then open Closedloop2.slx to see results
%_________________________________________________
R=35;
Rho=1.225;
Jr=2.96e6;
Jg=53.036;
Cls=1e5;
Kls=5.6e5;
Cr=625;
Cg=0.05;
ng=87.965;
beta_opt=2;
lambda_opt=7.1;
Cp_opt=0.4857;
a11=-Cr/Jr;
a12=0;
a13=-1/Jr;
a21=0;
a22=-Cg/Jg;
a23=1/ng/Jg;
a31=Kls-Cls*Cr/Jr;
a32=(Cls*Cg/Jg-Kls)/ng;
a33=-Cls*(Jr+ng^2*Jg)/(ng^2*Jg*Jr);
b11=1/Jr;
b12=0;
b21=0;
b22=-1/Jg;
b31=Cls/Jr;
b32=Cls/ng/Jg;
filename = 'Cp.xlsx';
Cp = xlsread(filename);
filename = 'v.xlsx';
vf = xlsread(filename);
TMax = 600;

lambda=10;
eta=0.05;
phi=0.001;

s=tf('s');
k11=0.045731*(s-2.853)*(s+0.2067)*(s-0.08103)*(s+0.01129)*(s+0.002339)/(s*(s+0.8325)*(s+0.1111)*(s+0.01274)*(s+0.002171));
k12=-0.021202*s*(s-0.5012)*(s+0.4041)*(s+0.03929)*(s+0.00226)/(s*(s+0.8325)*(s+0.1111)*(s+0.01274)*(s+0.002171));
k13=0.021524*s*(s+0.01209)*(s+0.002183)*(s^2 + 0.2398*s + 0.02808)/(s*(s+0.8325)*(s+0.1111)*(s+0.01274)*(s+0.002171));
k21=-0.018969*(s-3.714)*(s+1.149)*(s+0.04533)*(s+0.01038)*(s+0.002273)/(s*(s+0.8325)*(s+0.1111)*(s+0.01274)*(s+0.002171));
k22=0.032167*s*(s+0.9259)*(s+0.002234)*(s^2 - 0.01879*s + 0.006516)/(s*(s+0.8325)*(s+0.1111)*(s+0.01274)*(s+0.002171));
k23=0.020178*s*(s+0.6718)*(s+0.05862)*(s+0.0117)*(s+0.002179)/(s*(s+0.8325)*(s+0.1111)*(s+0.01274)*(s+0.002171));
K_dk=[k11,k12,k13;k21,k22,k23];
[A,B,C,D]=ssdata(K_dk);

A1=1/Jr;
A2=(Jr*(lambda-b31)-Cr)/Jr^2;
A3=(Cr^2-a31*Jr-lambda*Cr*Jr)/Jr^2;
A4=-a32/Jr;
A5=(Cr-a33*Jr-lambda*Jr)/Jr^2;
sim('Closedloop2.slx',[0,TMax]);